var controller=(function(b,g,l){var f=b("#record-page-btn"),h=b("#QR-code-rgp"),m=false,k,j,r=b("#backgroundFefresh"),e,a=b("#logo-win"),q;function c(){var s=location.href;b.ajax({type:"get",url:nodeurl+"wechat/initJSSDK.do",data:{pageUrl:s},dataType:dataType,beforeSend:function(t){},success:function(w){if(w.result=="ok"){var t=w.values,x=t.appid,y=t.timestamp,v=t.noncestr,u=t.signature;if(wx!=undefined){wx.config({debug:false,appId:x,timestamp:y,nonceStr:v,signature:u,jsApiList:["getLocation","openLocation","chooseWXPay","checkJsApi"]});r.show()}}else{alert(w.errormsg)}},error:function(){alert("error")},complete:function(t,u){}})}wx.ready(function(){wx.getLocation({type:"wgs84",success:function(s){k=s.latitude;j=s.longitude;return p()}})});function p(){var t={longitude:j,latitude:k,u_id:u_id},s="shop/getShopList.do",u=new PublickFn(s,t,o);u.ajaxFn();u=null}function o(y){var A="",v,x,B,C,t,s,u,z,w=y.length-1;if(w>-1){do{z=y[w];v=z.s_url||"../source/img/shop-back.png";x=z.s_name;B=z.s_address||"无";C=z.s_id;t=z.activity;u=z.s_distance||0;if(t==1){s="活动进行中"}else{s="没有活动"}A+='<li class="list-li-border-bottom" id='+C+"><div ><img src="+v+' alt="" id="shop-img"></div><ul><li><div class="shop-name">'+x+'</div><div class="shop-position">'+u+'米</div></li><li> <div class="ctivity-content">'+B+'</div><div class="is-shop"><span class="activity">'+s+"</span></div></li></ul></li>"}while(--w>=0)}else{A='<li class="notice-none">暂无店铺!</li>'}b("#list-shop-show").html(A);r.hide();return i()}function i(){b("#list-shop-show>li").on("click",function(){e=b(this).attr("id");d(e)})}function d(s){if(!s){return}b.ajax({type:"get",url:nodeurl+"game/getGameInfoBySid.do",data:{s_id:s},dataType:dataType,beforeSend:function(t){r.show()},success:function(v){r.hide();if(v.result=="ok"){var x="spectator.html?s_id="+s,t=v.values;locache.session.set("getGameInfoBySid",t);locache.session.set("dress-s_id",s);locationSelf.href=x}else{var w=v.errormsg;noticeSetTimeoutPublick(w);if(v.errorcode=="000022"){var u="#"+s;b(u).find(".activity").html("没有活动");locationSelf.href="shop-info-msg.html?s_id="+s}}},complete:function(t){},error:function(){r.hide()}})}a.on("click",function(){locationSelf.href="company-QR.html"});wx.error(function(s){alert("微信接口出现错误: "+s.errMsg)});var n=function(){c()};return{doInit:n}})(Zepto,window,document);$(function(){controller.doInit()});