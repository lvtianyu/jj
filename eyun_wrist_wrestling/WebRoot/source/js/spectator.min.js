var controller = function (e, t, n) {
    function i() {
        var e = locache.session.get("getGameInfoBySid");
        h = locache.session.get("dress-s_id") || oGetVars.s_id, e ? a(e) : o(), d = e.g_id, I.gameId = d, b = e.a, S = e.b, m = {
            g_id: d,
            g_a: e.a.u_id,
            g_b: e.b.u_id
        }, f = sessionStorage.getItem("userId"), I.userId = sessionStorage.getItem("userId"), w.html(b.nickname), r(m)
    }

    function o() {
        e.ajax({
            type: "get",
            url: nodeurl + "game/getGameInfoBySid.do",
            data: {s_id: h},
            dataType: dataType,
            beforeSend: function (e) {
                j.show()
            },
            success: function (e) {
                if (j.hide(), "ok" == e.result) {
                    var t = e.values;
                    return locache.session.set("getGameInfoBySid", t), a(t)
                }
                var n = e.errormsg;
                return noticeSetTimeoutPublick(n)
            },
            complete: function (e) {
            },
            error: function () {
                j.hide()
            }
        })
    }

    function a(t) {
        var n = t.a, i = t.b;
        _.attr("src", n.head_portrait), e("#first-nick-name").html(n.nickname), k.attr("src", i.head_portrait), e("#second-nick-name").html(i.nickname)
    }

    function r(t) {
        e.ajax({
            type: "get",
            url: nodeurl + "game/getThumbUpInfo.do",
            data: t,
            dataType: dataType,
            beforeSend: function (e) {
                j.show()
            },
            success: function (e) {
                if (j.hide(), "ok" == e.result) {
                    var t = e.values;
                    return c(t)
                }
                var n = e.errormsg;
                return noticeSetTimeoutPublick(n)
            },
            complete: function (e) {
            },
            error: function () {
                j.hide()
            }
        })
    }

    function c(e) {
        var t, n, i, o = "", a = e.list, r = a.length - 1;
        if (r > -1) {
            do i = a[r], t = i.head_portrait, n = i.nickname || "无名氏", o += '<li><div class="head-img-spectator"><img src=' + t + ' alt=""></div><ul><li class="nick-name-spectator">' + n + '</li><li class="support-money">1元</li></ul></li>'; while (--r >= 0);
            B.show()
        } else o = '<li class="notice-none">支持比赛的观众,结束比赛后可得到相应的红包,细节咨询店家!</li>', B.hide();
        1 == F ? (v.html(e.a_num), y.html(e.b_num)) : (v.html(e.b_num), y.html(e.a_num)), U.html(o), P.show()
    }

    function s(e) {
        console.log(this);
        var t, n = {g_id: d};
        return e.search("first") != -1 ? (n.g_a = b.u_id, n.g_b = S.u_id, F = 1, t = b.nickname) : (n.g_a = S.u_id, n.g_b = b.u_id, F = 2, t = S.nickname), w.html(t), n
    }

    function u() {
        var t = e(this).attr("id"), n = s(t);
        r(n)
    }

    function l(t) {
        e.ajax({
            type: "get",
            url: nodeurl + "wechat/payForGame.do",
            data: I,
            dataType: dataType,
            beforeSend: function (e) {
                j.show()
            },
            success: function (e) {
                if (j.hide(), T.hide(), "ok" != e.result) {
                    var n = e.errormsg;
                    return noticeSetTimeoutPublick(n)
                }
                var i = e.values;
                wx.chooseWXPay({
                    timestamp: i.timeStamp,
                    nonceStr: i.nonceStr,
                    package: i.package,
                    signType: "MD5",
                    paySign: i.paySign,
                    success: function (e) {
                        return r(t)
                    },
                    fail: function (e) {
                        alert("fail" + e)
                    },
                    cancel: function () {
                        alert("cancel" + res)
                    }
                })
            }
        })
    }

    var d, m, f, h, p = e("#first-support-btn"), g = e("#second-support-btn"), _ = e("#first-head-img"), k = e("#second-head-img"), v = e("#first-support-num"), y = e("#second-support-num"), b = {}, S = {}, w = e("#list-title"), I = {
        userId: f,
        totalFee: 1,
        applyType: 0
    }, T = e("#pay"), G = e("#pay-sure"), x = e(".back-game"), P = e("#list-show-view"), j = e("#backgroundFefresh"), B = e("#list-title-div"), F = 1, U = e("#list-show-ul");
    p.on("click", function () {
        I.sportUserId = b.u_id;
        var t = e(this).attr("id");
        m = s(t), T.show()
    }), g.on("click", function () {
        I.sportUserId = S.u_id;
        var t = e(this).attr("id");
        m = s(t), T.show()
    }), G.on("click", function () {
        l(m), j.show()
    }), x.on("click", function () {
        T.hide()
    }), e("#first-people").on("click", u), e("#second-people").on("click", u), e("#to-record").on("click", function () {
        locationSelf.href = "record-page.html?s_id=" + h
    });
    var D = function () {
        i()
    };
    return {doInit: D}
}(Zepto, window, document);
$(function () {
    controller.doInit()
});